<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Điều khiển LED từ xa</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding-top: 50px;
    background: #f5f5f5;
  }
  h2 {
    margin-bottom: 30px;
    font-weight: bold;
  }
  .led-container {
    display: inline-block;
    cursor: pointer;
    user-select: none;
  }
  .led {
    width: 150px;
    height: 150px;
    background: #fff;
    border-radius: 50%;
    box-shadow: 0 0 30px 10px rgba(255, 223, 0, 0.8);
    position: relative;
    transition: background-color 0.3s, box-shadow 0.3s;
  }
  .led.off {
    background: #ccc;
    box-shadow: none;
  }
  .led:before {
    content: "";
    position: absolute;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 90px;
    background: #ffd700;
    border-radius: 20px 20px 10px 10px;
    box-shadow: inset 0 5px 15px rgba(255, 255, 255, 0.6);
  }
  .status-text {
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h2>ỨNG DỤNG ĐIỀU KHIỂN LED TỪ XA QUA MẠNG</h2>

<div class="led-container" id="ledContainer">
  <div class="led" id="led"></div>
  <div class="status-text" id="statusText">Đang tắt</div>
</div>

<!-- MQTT script sẽ thêm ở phần sau -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>

<script>
  $(document).ready(function() {
  let ledOn = false;  // trạng thái đèn hiện tại

  // Hàm cập nhật giao diện đèn và trạng thái chữ
  function updateLedUI() {
    if (ledOn) {
      $('#led').removeClass('off');
      $('#statusText').text('Đang bật');
    } else {
      $('#led').addClass('off');
      $('#statusText').text('Đang tắt');
    }
  }

  // Khởi tạo giao diện lúc đầu
  updateLedUI();

  // MQTT client setup
  const clientId = "clientId_" + Math.floor(Math.random() * 1000);
  const client = new Paho.MQTT.Client("broker.emqx.io", 8083, clientId);

  client.onConnectionLost = function(responseObject) {
    console.log("Kết nối MQTT bị mất:", responseObject.errorMessage);
  };

  client.onMessageArrived = function(message) {
    console.log("Nhận tin nhắn:", message.payloadString);
    // Có thể dùng nếu muốn đồng bộ trạng thái từ server
  };

  client.connect({
    onSuccess: function() {
      console.log("MQTT đã kết nối");
      // Có thể subscribe nếu cần
    },
    onFailure: function(e) {
      console.log("MQTT kết nối lỗi:", e.errorMessage);
    }
  });

  // Khi click vào đèn
  $('#ledContainer').click(function() {
    if (!client.isConnected()) {
      alert("MQTT chưa kết nối, không thể gửi lệnh");
      return;
    }
    // Đổi trạng thái đèn
    ledOn = !ledOn;
    updateLedUI();

    // Gửi lệnh MQTT "on" hoặc "off"
    const message = new Paho.MQTT.Message(ledOn ? "on" : "off");
    message.destinationName = "tuanprohl";  // Topic bạn dùng
    client.send(message);
  });
});

</script>

</body>

</html>
